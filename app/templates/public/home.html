{% extends "base.html" %}

{% block title %}MiniStatus Home{% endblock %}

{% block content %}
<div class="container mx-auto py-8 px-2 sm:px-4 md:px-8 lg:px-8 xl:px-12 2xl:px-16">
  <!-- Top row: Country + Calendar | System Health | System Identity -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-8 items-start mb-10">
    <!-- Country + Calendar Card -->
    <div class="bg-light-card dark:bg-dark-card p-4 rounded-xl shadow w-full max-w-xs space-y-4 flex flex-col items-center border border-light-border dark:border-dark-border">
      <div class="w-full">
        <label for="calendar-country" class="text-sm text-light-muted dark:text-dark-muted">Country:</label>
        <select id="calendar-country" class="mt-1 w-full bg-light-nav dark:bg-dark-nav border border-light-border dark:border-dark-border text-light-text dark:text-dark-text text-sm rounded focus:ring-2 focus:ring-dark-primary">
          <option value="US">ðŸ‡ºðŸ‡¸ United States</option>
          <option value="GB">ðŸ‡¬ðŸ‡§ United Kingdom</option>
          <option value="DE">ðŸ‡©ðŸ‡ª Germany</option>
          <option value="FR">ðŸ‡«ðŸ‡· France</option>
          <option value="RU">ðŸ‡·ðŸ‡º Russia</option>
          <option value="UA">ðŸ‡ºðŸ‡¦ Ukraine</option>
          <option value="PL">ðŸ‡µðŸ‡± Poland</option>
          <option value="IT">ðŸ‡®ðŸ‡¹ Italy</option>
          <option value="ES">ðŸ‡ªðŸ‡¸ Spain</option>
          <option value="CN">ðŸ‡¨ðŸ‡³ China</option>
          <option value="JP">ðŸ‡¯ðŸ‡µ Japan</option>
          <option value="IN">ðŸ‡®ðŸ‡³ India</option>
          <option value="BR">ðŸ‡§ðŸ‡· Brazil</option>
        </select>
      </div>
      <div id="calendar" class="rounded-lg w-full"></div>
      <div id="calendar-events" class="mt-2 w-full text-center text-light-text dark:text-dark-text text-xs"></div>
    </div>
    <!-- System Health -->
    <div class="bg-light-card dark:bg-dark-card rounded-xl shadow p-6 flex flex-col items-center border border-light-border dark:border-dark-border">
      <h2 class="text-xl font-bold mb-4 text-light-text dark:text-dark-text">System Health</h2>
      <div class="flex flex-col gap-2 w-full text-light-text dark:text-dark-text">
        <div>CPU: <span class="font-mono">{{ system_stats.cpu }}%</span></div>
        <div>RAM: <span class="font-mono">{{ system_stats.ram }}%</span></div>
        <div>Disk: <span class="font-mono">{{ system_stats.disk }}%</span></div>
        <div>Uptime: <span class="font-mono">{{ system_stats.uptime | string | replace('days', 'd') | replace('day', 'd') | replace(':', 'h ', 1) ~ 'm' }}</span></div>
      </div>
    </div>
    <!-- System Identity -->
    <div class="bg-light-card dark:bg-dark-card rounded-xl shadow p-6 flex flex-col items-center border border-light-border dark:border-dark-border">
      <h2 class="text-xl font-bold mb-4 text-light-text dark:text-dark-text">System Identity</h2>
      <div class="flex flex-col gap-2 w-full text-light-text dark:text-dark-text">
        <div>ðŸ–¥ Host: <span class="font-mono">{{ system_identity.hostname }}</span></div>
        <div>ðŸ§ª OS: <span class="font-mono">{{ system_identity.os }}</span></div>
        <div>ðŸ§· Kernel: <span class="font-mono">{{ system_identity.kernel }}</span></div>
      </div>
    </div>
  </div>
  <!-- Quick Links Grid -->
  <div>
    <h2 class="text-xl font-bold mb-4 text-light-text dark:text-dark-text">Quick Links</h2>
    {% if quick_links %}
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
        {% for link in quick_links %}
        <div class="bg-light-card dark:bg-dark-card rounded-xl shadow p-4 border border-light-border dark:border-dark-border flex flex-col items-center">
          <a href="{{ link.url }}" target="_blank" class="bg-light-nav dark:bg-dark-nav hover:bg-light-primary dark:hover:bg-dark-primary text-light-text dark:text-dark-text px-3 py-2 rounded-xl shadow flex items-center gap-2 transition relative group border border-light-border dark:border-dark-border hover:border-light-accent dark:hover:border-dark-accent mb-2" title="{{ link.name }}">
            {% if link.icon %}
              <img src="https://cdn.simpleicons.org/{{ link.icon | lower }}?color=6366f1&dark=fff" alt="{{ link.name }}" class="w-7 h-7 group-hover:scale-110 transition-transform" onerror="this.onerror=null;this.src='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/icons/app.svg'">
            {% else %}
              <svg class="w-7 h-7 text-light-muted dark:text-dark-muted" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/></svg>
            {% endif %}
          </a>
          <div class="text-sm font-semibold text-light-text dark:text-dark-text text-center">{{ link.name }}</div>
          <div class="text-xs text-light-muted dark:text-dark-muted text-center">{{ link.category }}</div>
        </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="text-gray-500">No known services detected.</div>
    {% endif %}
  </div>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet">
  <style>
    body, .bg-dark-card { background: #181c23 !important; }
    .fc { background: #232733 !important; color: #e5e7eb; border-radius: 1rem; }
    .fc-toolbar-title, .fc-col-header-cell-cushion, .fc-daygrid-day-number { color: #e5e7eb !important; }
    .fc-daygrid-day.fc-day-today { background: #6366f1 !important; color: #fff !important; border-radius: 50% !important; box-shadow: 0 0 0 2px #6366f1, 0 0 8px #6366f1; }
    .fc-button-primary { background: #6366f1 !important; border: none; color: #fff !important; }
    .fc-button-primary:not(:disabled):hover { background: #4f46e5 !important; }
    .fc-daygrid-event { background: #2496ed !important; color: #fff !important; border-radius: 0.5rem; }
    select#calendar-country, select#calendar-country option { background: #232733 !important; color: #e5e7eb !important; }
    /* Compact calendar tweaks */
    .fc .fc-scrollgrid-section-body, .fc .fc-daygrid-body { max-height: none !important; overflow: visible !important; }
    .fc .fc-daygrid-body { min-height: 0 !important; }
    .fc .fc-scrollgrid-sync-table { min-height: 0 !important; }
    .fc .fc-daygrid { min-height: 0 !important; }
    .fc .fc-daygrid-day { height: 1.8rem !important; font-size: 0.85rem !important; padding: 0.3rem !important; }
    .fc .fc-toolbar { margin-bottom: 0.5rem !important; }
    .fc .fc-toolbar-chunk { margin-bottom: 0 !important; }
    .fc .fc-toolbar-title { font-size: 1.1rem !important; }
    .fc .fc-button-group { height: 2rem !important; }
    .fc .fc-button { height: 2rem !important; min-width: 2rem !important; font-size: 0.9rem !important; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var calendarEl = document.getElementById('calendar');
      var eventsEl = document.getElementById('calendar-events');
      var countrySelect = document.getElementById('calendar-country');
      var selectedCountry = countrySelect.value;
      countrySelect.addEventListener('change', function() {
        selectedCountry = this.value;
        eventsEl.innerHTML = '';
      });
      var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        height: 'auto',
        contentHeight: 'auto',
        fixedWeekCount: false,
        aspectRatio: 1.1,
        handleWindowResize: true,
        dateClick: function(info) {
          fetch(`https://date.nager.at/api/v3/PublicHolidays/${info.date.getFullYear()}/${selectedCountry}`)
            .then(res => res.json())
            .then(data => {
              const events = data.filter(ev => ev.date === info.dateStr);
              if (events.length > 0) {
                eventsEl.innerHTML = `<b>Events for ${info.dateStr} (${selectedCountry}):</b><br>` +
                  events.map(ev => `<span>${ev.localName} (${ev.name})</span>`).join('<br>');
              } else {
                eventsEl.innerHTML = `<b>No public events for ${info.dateStr} (${selectedCountry})</b>`;
              }
            })
            .catch(() => {
              eventsEl.innerHTML = 'Could not fetch events.';
            });
        }
      });
      calendar.render();
    });
  </script>
  <!-- More widgets will be added here in the next steps -->
</div>
{% endblock %} 